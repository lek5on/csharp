using System;
using System.Collections.Generic;
using System.Windows.Forms;
using Microsoft.Office.Interop.Excel;

namespace C_sharp_3курс
{
    public partial class Form1 : Form
    {
        List<User> users;
        public Form1()
        {
            InitializeComponent(); 
            users = new List<User>(); 
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            city.Items.AddRange(new string[] { "Москва", "Краснодар", "Питер", "Сочи" });
            section.Items.AddRange(new string[] { "Футбол", "Художка", "Гончарное дело", "Регби" });
        }

        private void accept_Click(object sender, EventArgs e)
        {
            string inputFio = fio.Text;
            string inputCity = city.Text;
            string inputSection = section.Text;

            string inputSex;
            if (male.Checked)
            {
                inputSex = "Мужской";
            }
            else inputSex = "Женский";


            if (inputCity == "" || inputFio == "" || inputSex == "" || inputSection == "")
            {
                MessageBox.Show("Заполните все поля.");
                return;
            }

            User u = new User(inputFio, inputSex, inputCity, inputSection);
            users.Add(u);

            fio.Clear();      
            male.Checked = true; 
            fio.Focus();         

            MessageBox.Show($"Результаты сохранены!");

            info.Text = $"{u.fio} из города {u.city} ходит на {u.section} и пол у него {u.sex}";
        }

        private void excelButton_Click(object sender, EventArgs e)
        {
            OpenFileDialog ofd = new OpenFileDialog();
            ofd.ShowDialog();
            String filename = ofd.FileName;

            Microsoft.Office.Interop.Excel.Application excelObj = new Microsoft.Office.Interop.Excel.Application();
            excelObj.Visible = true;

            Workbook wb = excelObj.Workbooks.Open(filename, 0, false, 5, "", "", false, XlPlatform.xlWindows, "", true, false, 0, true, false, false);

            Worksheet wsh = wb.Sheets[1];

            wsh.Cells[1, 1] = "Имя пользователя";
            wsh.Cells[1, 2] = "Город";
            wsh.Cells[1, 3] = "Хобби";
            wsh.Cells[1, 4] = "Пол";

            for (int i = 0; i < users.Count; i++)
            {
                wsh.Cells[i + 2, 1] = users[i].fio;
                wsh.Cells[i + 2, 2] = users[i].city;
                wsh.Cells[i + 2, 3] = users[i].section;
                wsh.Cells[i + 2, 4] = users[i].sex;
            }

            wb.Save();
            wb.Close();

            excelObj.Quit();
        }
    }

    public class User
    {
        public string fio;
        public string sex;
        public string city;
        public string section;

        public User(string fio, string sex, string city, string section)
        {
            this.fio = fio;
            this.sex = sex;
            this.city = city;
            this.section = section;
        }
    }
}
